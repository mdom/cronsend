#!/usr/bin/perl

use strict;
use warnings;
use File::Temp qw(tempfile);
use File::Copy qw(move);

@ARGV = glob('/etc/mail-reminder/*');

my $cron_file = '/etc/cron.d/mail-reminder';

my ( $fh, $filename ) = tempfile( UNLINK => 1 );
print {$fh} "# autogenerate by update-mail-reminder\n\n";

while (<>) {
    chomp;
    if ( 1 ... /^$/ ) {
        my ( $key, $val ) = split( ': ', $_, 2 );
        if ( defined $key and $key eq 'X-Cron' ) {
            print {$fh}
              "$entry robbie /usr/local/bin/send-mail-reminder $ARGV\n";
        }
    }
    else {
        close ARGV;
    }
}

close($fh);

move( $filename, $cron_file )
  or die "Can't move temp file to $cron_file: $!\n";

exit 0;
